<ng-view></ng-view>
<div class="apply-bootstrap" ng-show="view !== 'login' && view !== 'getstarted'">
  <div class="vtHeader clearfix" style="margin-left:-10px !important;;margin-right:-15px !important;">
    <div class="col-sm-9" style="margin-left:-10px !important">
      <div>
        <!--   17.11.2020  :  Scrollbar Issue  -->
        <div id="scrollable-dropdown-menu" class="form-group wgt-form-group scrollable-dropdown-menu" ng-form="innerForm" ng-init="referenceModuleName='Contacts'">
          <input class="form-control" type="text" ng-model="searchTextField" ng-focus="Contacts" name="fieldValue" placeholder="Type to search" typeahead="record as record.labelToShowInSuggestions for record in getReferenceRecords($viewValue)" typeahead-editable="true" typeahead-min-length="3" ng-required="field.mandatory" typeahead-on-select="onSelect($item, $model, $label)" autocomplete="off">
        </div>
      </div>
    </div>
    <div class="col-sm-3" style="margin-right:-10px !important;">
      <span class="pull-right">
        <i ng-show="view !== 'login'" class="pull-right fa fa-power-off logout cursor-pointer action-icon" ng-really-click="logout()" ng-really-message="Are you sure you want to logout of Repbox?" title="Logout"></i>
      </span>
      <span class="user-display-name pull-right">
        <a href="{{userpreferenceUrl}}" target="_blank" title="{{currentUserFirstName}}">{{currentUserFirstName|cut:false:15:'..'}}</a>
      </span>
    </div>
  </div>
</div>
<div id="vtigerwidget-body" class="apply-bootstrap" ng-init="email = '<%= email%>';name = '<%= name%>'; gmailId = '<%= emailIdentifier%>'">
  <input type="hidden" id="vtiger-gadget-context" ng-model="email" value="{{email}}" />
  <input type="hidden" ng-model="name" />
  <input type="hidden" ng-model="module" />
  <input type="hidden" ng-model="crmRecordId" />
  <div ng-show="view === 'getstarted'">
    <div id="mainView">
      <div class="center-block clearfix">
        <img src="<%= baseresourceurl%>assets/images/main.png" />
        <button ng-click="getStarted()" class="btn btn-primary center-block wgt-control getstarted-button cursor-pointer" type="button" ng-disabled="connecting"><span ng-show="!connecting">Get Started</span><span ng-show="connecting">Please wait</span></button>
      </div>
    </div>
  </div>
  <div ng-show="view === 'login'">
    <div id="loginView" ng-controller="LoginController" ng-class="getLoginViewClass()">
      <div class="loginwrapper">
        <div class="center-block clearfix">
          <img class="vtigerlogo" src="<%= baseresourceurl%>assets/images/logo.png">
        </div>
        <span>
          <br> Please provide your account credentials.
          <br> Once logged-in, you will be able to archive emails to Repbox and interact with your dashboard.
        </span>
        <div class="loginformwrapper">
          <form ng-submit="login(form.$valid)" name="form" novalidate>
            <div ng-show="localTesting" class="form-group input-group center-block clearfix"><input type="text" class="form-control wgt-control" placeholder="InstanceURL" ng-model="crmInstanceUrl" /></div>
            <div class="form-group input-group center-block clearfix">
              <input type="text" class="form-control wgt-control" placeholder="Username" required autofocus="" ng-model="username" name="username" ng-focus="usernameFocus = true" ng-blur="usernameFocus = false" />
              <span class="validationtext" ng-show="form.username.$dirty && form.username.$invalid">
                <span ng-show="form.username.$error.required">Username is required.</span>
                <span ng-show="form.username.$error.email && !usernameFocus">Invalid email address.</span>
              </span>
            </div>
            <div class="form-group input-group center-block clearfix">
              <input type="password" class="form-control wgt-control" placeholder="Password" required ng-model="password" name="password" />
              <span class="validationtext" ng-show="form.password.$dirty && form.password.$invalid">
                <span ng-show="form.password.$error.required">Password is required.</span>
              </span>
            </div>
            <p id="login-error invalid_credentials" class="redColor center-block" ng-show="invalidCredentials">
              <span>&nbsp;Please check your credentials</span>
            </p>
            <p class="login-error redColor center-block" ng-show="loginError.status">
              <span>&nbsp;{{loginError.message}}</span>
            </p>
            <div class="center-block clearfix">
              <button class="btn btn-primary center-block wgt-control login-button" type="submit" ng-disabled="connecting"><span ng-show="!connecting">Login</span><span ng-show="connecting">Please wait</span></button>
            </div>
          </form>
        </div>
        <div class="signupdetails">
          <span>Don't have an account?</span>
          <a href="https://www.repbox.co/demo " target="_blank">Sign up</a>
        </div>
      </div>
    </div>
  </div>
  <div ng-show="view === 'create'">
    <div class="contact-header clearfix">
      <div class="inlineblock"><img src="<%= baseresourceurl%>assets/images/summary_Contact.png" class="summaryImg"></div>
      <div class="inlineblock header-text">
        <div class="namecard-name" title="{{name}}"><b>{{name}}</b></div>
        <div class="namecard-email" title="{{email}}"><small>{{email}}</small></div>
      </div>
    </div>
    <div class="createviewwrapper" ng-controller="CreateController">
      <div class="createoptionscontainer">
        <div ng-show="!fetchingModules">
          <button ng-show="contactsModuleEnable" ng-click="showCreateForm('Contacts')" data-module="Contacts" class="btn btn-large btn-primary center-block btn-block">Create Contact</button>
          <button ng-show="leadsModuleEnable" ng-click="showCreateForm('Leads')" data-module="Leads" class="btn btn-large btn-warning center-block btn-block">Create Lead</button>
          <button ng-show="accountsModuleEnable" ng-click="showCreateForm('Accounts')" data-module="Accounts" class="btn btn-large btn-warning center-block btn-block">Create Account</button>
          <button ng-click="showCreateForm('Potentials')" data-module="Potentials" class="btn btn-large btn-warning center-block btn-block">Create Opportunity</button>
          <div class="redColor" ng-show="!contactsModuleEnable && !leadsModuleEnable">
            Access denied : You do not have the permission to create Contact and Leads!
            Contact your Administrator to get access.
          </div>
        </div>
        <div ng-show="fetchingModules">
          <img src="<%= baseresourceurl%>assets/images/load.gif" style="display: block; margin-right: auto; margin-left: auto;">
        </div>
      </div>
    </div>
  </div>
  <div ng-show="view === 'edit'">
    <div class="contact-header clearfix">
      <div class="inlineblock"><img ng-src="<%= baseresourceurl%>assets/images/{{module}}.svg" class="summaryImg"></div>
      <div class="inlineblock header-text">
        <div class="namecard-name" title="{{name}}"><b>{{name}}</b></div>
        <div class="namecard-email" title="{{email}}"><small>{{email}}</small></div>
      </div>
    </div>
    <div class="createviewwrapper" ng-controller="EditController">
      <div class="createformcontainer">
        <div class="header-title" ng-show="!crmRecordId">Creating
          {{ moduleLabel() }}
        </div>
        <div class="header-title" ng-show="crmRecordId">Editing
          {{ moduleLabel() }}
        </div>
        <form ng-submit="create(form.$valid)" class="clearfix" name="form" novalidate>
          <div ng-repeat="field in secondaryModuleFields" ng-if=" module=='Potentials' ">
            <div ng-switch on="field.type.name">
              <div ng-switch-when="string">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>Contact {{field.label}}</label>
                  <input class="form-control" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                    {{field.label}} is required
                  </span>
                </div>
              </div>
              <div ng-switch-when="email">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>Contact {{field.label}}</label>
                  <input class="form-control" type="email" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                    {{field.label}} required
                  </span>
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.email">
                    Invalid email
                  </span>
                </div>
              </div>
              <div ng-switch-default>
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <span class="vtinput-prepend">
                    <input class="form-control" type="text" ng-model="field.fieldValue" date-picker name="fieldValue" ng-required="field.mandatory" />
                    <span class="vtinput-addon"><i class="fa fa-calendar"></i></span>
                  </span>
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                    {{field.label}} is required
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div ng-repeat="field in formFields">
            <div ng-switch on="field.type.name">
              <div ng-switch-when="string">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <input class="form-control" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                    {{field.label}} is required
                  </span>
                </div>
              </div>
              <div ng-switch-when="email">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <input class="form-control" type="email" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                    {{field.label}} required
                  </span>
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.email">
                    Invalid email
                  </span>
                </div>
              </div>
              <div ng-switch-when="phone">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <input class="form-control" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                    {{field.label}} is required
                  </span>
                </div>
              </div>
              <div ng-switch-when="owner">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <select class="form-control" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-options="owner.value as owner.label for owner in owners">
                  </select>
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                    {{field.label}} is required
                  </span>
                </div>
              </div>
              <div ng-switch-when="picklist">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <select class="form-control" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-options="picklistValue.value as picklistValue.label for picklistValue in field.type.picklistValues">
                  </select>
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                    {{field.label}} is required
                  </span>
                </div>
              </div>
              <div ng-switch-when="integer">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <input class="form-control" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-pattern="/^\d+$/" />
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                    {{field.label}} is required
                  </span>
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number || innerForm.fieldValue.$error.pattern">
                    Enter valid number
                  </span>
                </div>
              </div>
              <div ng-switch-when="decimal">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <input class="form-control" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                    {{field.label}} is required
                  </span>
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number">
                    Enter valid number
                  </span>
                </div>
              </div>
              <div ng-switch-when="date">
                <div ng-switch on="field.name">
                  <div ng-switch-when="birthday">
                    <div class="form-group wgt-form-group" ng-form="innerForm">
                      <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                      <span class="vtinput-prepend">
                        <input class="form-control" type="text" ng-model="field.fieldValue" birthday-date-picker name="fieldValue" ng-required="field.mandatory" />
                        <span class="vtinput-addon"><i class="fa fa-calendar"></i></span>
                      </span>
                      <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                        {{field.label}} is required
                      </span>
                    </div>
                  </div>
                  <div ng-switch-default>
                    <div class="form-group wgt-form-group" ng-form="innerForm">
                      <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                      <span class="vtinput-prepend">
                        <input class="form-control" type="text" ng-model="field.fieldValue" date-picker name="fieldValue" ng-required="field.mandatory" />
                        <span class="vtinput-addon"><i class="fa fa-calendar"></i></span>
                      </span>
                      <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                        {{field.label}} is required
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              <div ng-switch-when="time">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <span class="vtinput-prepend">
                    <input class="form-control" type="text" class="time" ng-model="field.fieldValue" time-picker name="fieldValue" ng-required="field.mandatory" />
                    <span class="vtinput-addon"><i class="fa fa-clock-o"></i></span>
                  </span>
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                    {{field.label}} is required
                  </span>
                </div>
              </div>
              <div ng-switch-when="multipicklist">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <ui-select multiple ng-model="field.fieldValue" theme="bootstrap" style="width: 100%;height: 100%;" name="fieldValue" ng-required="field.mandatory" ui-select-required>
                    <ui-select-match placeholder="">{{$item.label}}</ui-select-match>
                    <ui-select-choices repeat="picklistValue.value as picklistValue in  field.type.picklistValues| propsFilter: {label: $select.search}">
                      <div ng-bind-html="picklistValue.label | highlight: $select.search"></div>
                    </ui-select-choices>
                  </ui-select>
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                    {{field.label}} is required
                  </span>
                </div>
              </div>
              <div ng-switch-when="url">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <input class="form-control" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-pattern="/\w+\.\w+/" />
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                    {{field.label}} is required
                  </span>
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.pattern">
                    Enter valid Url
                  </span>
                </div>
              </div>
              <div ng-switch-when="skype">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <input class="form-control" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                    {{field.label}} is required
                  </span>
                </div>
              </div>
              <div ng-switch-when="boolean">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <input class="" type="checkbox" ng-model="field.fieldValue" name="fieldValue" ng-true-value="'1'" ng-false-value="'0'" ng-required="field.mandatory" />
                </div>
                <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                  {{field.label}} is required
                </span>
              </div>
              <div ng-switch-when="text">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <textarea class="form-control textarea-field" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory"></textarea>
                </div>
                <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                  {{field.label}} is required
                </span>
              </div>
              <div ng-switch-when="double">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <input class="form-control" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                    {{field.label}} is required
                  </span>
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number">
                    Enter valid Number
                  </span>
                </div>
              </div>
              <div ng-switch-when="currency">
                <div class="form-group wgt-form-group" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <span class="vtinput-prepend">
                    <span class="vtinput-addon">{{userpreferences.currency_symbol}}</span>
                    <input class="form-control" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                  </span>
                  <span class="validationtext" ng-show="innerForm.$dirty &&  innerForm.fieldValue.$error.required">
                    {{field.label}} is required
                  </span>
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number">
                    Enter valid number
                  </span>
                </div>
              </div>
              <div ng-switch-when="multicurrency">
                <div class="wgt-form-group clearfix" ng-form="innerForm">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <span class="vtinput-prepend">
                    <span class="vtinput-addon">{{userpreferences.currency_symbol}}</span>
                    <input class="small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                  </span>
                  <span class="validationtext" ng-show="innerForm.$dirty &&  innerForm.fieldValue.$error.required">
                    {{field.label}} is required
                  </span>
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number">
                    Enter valid number
                  </span>
                </div>
              </div>
              <div ng-switch-when="reference">
                <div class="form-group wgt-form-group" ng-form="innerForm" ng-init="referenceModuleName='{{field.type.refersTo[0]}}'">
                  <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                  <input class="form-control" type="text" ng-model="field.fieldValue" ng-focus="setCurrentReferenceModuleName(field.type.refersTo[0])" name="fieldValue" placeholder="Type to search" typeahead="record as record.label for record in getReferenceRecords($viewValue)" typeahead-editable="true" typeahead-min-length="3" ng-required="field.mandatory">
                  <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                    {{field.label}} is required
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div class="validationtext animate-show" ng-show="numberOfEmailFields == 0 && formFields.length && module!='Potentials' ">
            Please quick-create enable at least one email field from edit fields for seamless integration with the CRM.
          </div>
          <div class="validationtext animate-show" ng-show="showValidationMsg">
            Invalid inputs provided.
          </div>
          <div class="form-group wgt-form-group clearfix editFormButtonGroupContainer" ng-show="formFields.length" style="margin-top: 15px;text-align: center;margin-bottom:30px !important;">
            <span class="editFormButtonGroup">
              <button type="submit" class="btn btn-primary" ng-disabled="savingRecord"><span ng-show="!savingRecord">Save</span><span ng-show="savingRecord">Please wait</span></button>
              <a class="red-color cursor-pointer linkaction" ng-hide="savingRecord" ng-click="changeView('')">Cancel</a>
            </span>
          </div>
        </form>
        <div ng-show="editViewBusy">
          <img src="<%= baseresourceurl%>assets/images/loading.gif" style="display: block; margin-right: auto; margin-left: auto;">
        </div>
      </div>
    </div>
  </div>
  <div ng-show="view === 'summary'" class="view-container">
    <div class="contact-header clearfix">
      <div class="logo inlineblock">
        <img ng-src="<%= baseresourceurl%>assets/images/{{module}}.svg" class="summaryImg">
      </div>
      <div class="inlineblock header-text">
        <div class="details inlineblock floatLeft">
          <div class="namecard-name" title="{{name}}">
            <b>
              <a target="_blank" href="{{crmRecordDetailViewUrl}}" style="text-decoration: none !important;">{{name}}</a>
            </b>
          </div>
          <div class="namecard-email" title="{{email}}"><small>{{email}}</small></div>
        </div>
        <div class="actions record-header-actions inlineblock floatRight clearfix">
          <i class="fa fa-link action-icon" title="Link email to this {{module}}" ng-controller="AttachEmailController" ng-really-click="attachEmail(undefined, crmRecord)" ng-really-message="Do you want to archive this email to Repbox?"></i>
          <!--<a ng-show="crmRecord.editPermission != 0" class="fa fa-pencil cursor-pointer action-icon pull-right" href="#/edit" title="Edit"></a>   -->
          <a ng-show="crmRecord.editPermission != 0" class="fa fa-pencil cursor-pointer action-icon pull-right" title="Edit" href="" ng-click="editIconClicked()" ng-controller="EditIconClickedController">
          </a>
        </div>
      </div>
    </div>
    <div class="summaryviewwrapper" ng-controller="RecordSummaryController">
      <div class="tabview">
        <div class="tab-menu" ng-if="!tab">
          <div class="list-group" style="margin-top:0px;">
            <a href="#/detail" ng-class="getTabMenuClass('detail')" class="list-group-item text-center" title="Details">
              <i class="vicon-details"></i> <span class="moduleName clearfix"> Details </span> <i class="fa fa-angle-right floatRight"></i>
            </a>
            <a href="#/timeline" ng-class="getTabMenuClass('timeline')" class="list-group-item text-center" title="Timeline" style="display:none">
              <i class="fa fa-dashboard"></i> <span class="moduleName timeline clearfix"> Timeline </span> <i class="fa fa-angle-right floatRight"></i>
            </a>
            <a href="#/events" ng-show="isModuleActive('Events')" ng-class="getTabMenuClass('activities')" class="list-group-item text-center" title="Activities">
              <i class="fa fa-calendar"></i> <span class="moduleName activities clearfix"> Activities </span> <i class="fa fa-angle-right floatRight"></i>
            </a>
            <a href="#/emails" ng-show="isModuleActive('Emails')" ng-class="getTabMenuClass('emails')" class="list-group-item text-center" title="Emails" style="display:none">
              <i class="vicon-emails"></i><span class="moduleName clearfix"> Emails </span> <i class="fa fa-angle-right floatRight"></i>
            </a>
            <a href="#/quotes" ng-show="isModuleActive('Quotes')" ng-class="getTabMenuClass('quotes')" class="list-group-item text-center" title="Quotes" style="display:none">
              <i class="vicon-quotes"></i><span class="moduleName clearfix"> Quotes </span> <i class="fa fa-angle-right floatRight"></i>
            </a>
            <a href="#/invoices" ng-show="isModuleActive('Invoice')" ng-class="getTabMenuClass('invoices')" class="list-group-item text-center" title="Invoices" style="display:none">
              <i class="vicon-invoice"></i> <span class="moduleName clearfix"> Invoices </span><i class="fa fa-angle-right floatRight"></i>
            </a>
            <a href="#/potentials" ng-show="isModuleActive('Potentials')" ng-class="getTabMenuClass('opportunities')" class="list-group-item text-center" title="Opportunities">
              <i class="vicon-potentials"></i> <span class="moduleName clearfix"> Opportunities </span> <i class="fa fa-angle-right floatRight"></i>
            </a>
            <a href="#/cases" ng-show="isModuleActive('Cases')" ng-class="getTabMenuClass('cases')" class="list-group-item text-center" title="Cases" style="display:none">
              <i class="vicon-cases"></i> <span class="moduleName clearfix"> Cases </span> <i class="fa fa-angle-right floatRight"></i>
            </a>
            <a href="#/helpdesk" ng-show="isModuleActive('HelpDesk')" ng-class="getTabMenuClass('helpdesk')" class="list-group-item text-center" title="Tickets" style="display:none">
              <i class="vicon-helpdesk"></i> <span class="moduleName clearfix"> HelpDesk </span> <i class="fa fa-angle-right floatRight"></i>
            </a>
            <a href="#/comments" ng-show="isModuleActive('ModComments')" ng-class="getTabMenuClass('comments')" class="list-group-item text-center" title="Comments">
              <i class="fa fa-comment"></i> <span class="moduleName clearfix"> Comments </span> <i class="fa fa-angle-right floatRight"></i>
            </a>
            <a href="#/settings" ng-class="getTabMenuClass('settings')" class="list-group-item text-center" title="Gadget Settings" style="display:none">
              <i class="fa fa-cog"></i> <span class="moduleName clearfix"> Settings </span> <i class="fa fa-angle-right floatRight"></i>
            </a>
          </div>
        </div>
        <div class="tab" ng-if="tab">
          <div class="goBack"> <a class="btn btn-large" href="#/summary"> <i class="fa fa-angle-left"> </i> Back </a> </div>
          <div class="separator" style="height:10px;margin: 0px -15px;background-color:#F7F7F7;"> </div>
          <div class="tab-content active detailstab" ng-show="tab === 'detail'">
            <div ng-controller="DetailViewController">
              <div class="listviewheadercontainer">
                <span class="title"> Details </span>
              </div>
              <div class="detailviewcontainer">
                <div class="field" ng-repeat="detail in recordDetails">
                  <div class="" id="detailview-fieldname" title="{{detail.fieldLabel}}">
                    {{detail.fieldLabel}}
                  </div>
                  <div class="">
                    <div ng-switch on="detail.fieldType">
                      <div ng-switch-when="owner" class="display-fieldValue">
                        <a target="_blank" title={{detail.fieldValue.label}} href="{{detail.fieldValue.detailViewUrl}}">{{detail.fieldValue.label}}</a>
                      </div>
                      <div ng-switch-default>
                        <div class="display-fieldValue" title={{detail.fieldValue|htmldecode}}>
                          <span ng-bind-html="detail.fieldValue" ng-if="detail.fieldValue"> </span>
                          <span class="emptyValue" ng-if="!detail.fieldValue"> -- </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div ng-show="!detailViewBusy && !recordDetails.length">
                  <i class="fa fa-info">
                    <div>Please enable at least one summary field in the CRM</div>
                  </i>
                </div>
                <div ng-show="detailViewBusy && !recordDetails.length">
                  <img src="<%= baseresourceurl%>assets/images/load.gif" style="display: block; margin-right: auto; margin-left: auto;">
                </div>
              </div>
            </div>
          </div>
          <div class="tab-content active timelinetab" ng-show="tab === 'timeline'">
            <div ng-controller="TimelineController">
              <div class="listviewheadercontainer">
                <span class="title"> Timeline </span>
              </div>
              <div>
                <ul class="timeline" ng-show="feed.length && !loading">
                  <li class="timelinepost display-inline-block" ng-repeat="post in feed">
                    <div class="timeline-badge info"><i class="" ng-class="getIconClass(post.values.record.module)"></i></div>
                    <div class="timeline-panel">
                      <div class="timeline-heading cursor-pointer" toggle-feed-content>
                        <div class="timeline-title"><b>{{post.modifieduser.label}}</b> {{post.label}} <i ng-show="post.values.record.module !== 'ModComments'"><a target="_blank" href="{{post.detailViewUrl}}">{{post.values.record.label}}</a></i></div>
                        <div class="timeline-time text-muted"><i class="glyphicon glyphicon-time"></i>&nbsp;{{post.modifiedtime | formatDateTimeToLocalTimeZone}}</div>
                      </div>
                      <div ng-show="post.values.record.module === 'ModComments'" class="timeline-body">
                        <span class="cmt-quote">&ldquo; </span>{{post.values.record.label}}<span class="cmt-quote"> &rdquo;</span>
                      </div>
                    </div>
                  </li>
                </ul>
                <div class="no-data-message" ng-show="!feed.length && !loading">
                  No timeline data
                </div>
                <div ng-show="loading && !feed.length">
                  <img src="<%= baseresourceurl%>assets/images/load.gif" style="display: block; margin-right: auto; margin-left: auto;">
                </div>
              </div>
            </div>
          </div>
          <div class="tab-content activitiestab" ng-show="tab === 'activities'">
            <div ng-controller="ActivitiesController">
              <div class="listviewheadercontainer">
                <span class="title" ng-show="mode !== 'edit' && !showForm">Activities</span>
                <span class="title" ng-show="mode !== 'edit' && showForm">Creating Event</span>
                <span class="title" ng-show="mode === 'edit'">Editing Event</span>
                <i ng-show="showForm === false && hasCreatePermission" class="add-record-icon fa fa-plus pull-right cursor-pointer" ng-click="showCreateForm()" title="Add Event"></i>
              </div>
              <div class="createActivityForm animate-show clearfix" ng-show="showForm">
                <form ng-submit="create(form.$valid)" name="form" novalidate class="clearfix moduleCreateForm" ng-show="subject && formFields">
                  <div class="wgt-form-group clearfix">
                    <label class="fieldlabel" title="{{subject.label}}"><span class="redColor mandatoryIndicator" ng-show="subject.mandatory">*</span>{{subject.label}}</label>
                    <input class="form-control small-input col-sm-12" type="text" ng-model="subject.fieldValue" name="subject" ng-required="subject.mandatory" />
                    <span class="validationtext" ng-show="form.subject.$dirty && form.subject.$invalid">
                      <span ng-show="form.subject.$error.required">{{subject.label}} is required.</span>
                    </span>
                  </div>
                  <div class="wgt-form-group padding-left-zero padding-right-one clearfix">
                    <label class="fieldlabel" title="{{activitytype.label}}"><span class="redColor mandatoryIndicator" ng-show="activitytype.mandatory">*</span>{{activitytype.label}}</label>
                    <select class="form-control small-input col-sm-12" ng-model="activitytype.fieldValue" name="activitytype" ng-required="activitytype.mandatory" ng-options="picklistValue.value as picklistValue.label for picklistValue in activitytype.type.picklistValues | filter:{'value':'!Task'}" change-event-duration>
                    </select>
                    <span class="validationtext" ng-show="form.activitytype.$dirty && form.activitytype.$invalid">
                      <span ng-show="form.activitytype.$error.required">{{activitytype.label}} is required.</span>
                    </span>
                  </div>
                  <div class="wgt-form-group padding-right-zero padding-left-one clearfix">
                    <label class="fieldlabel" title="{{assigned_user_id.label}}"><span class="redColor mandatoryIndicator" ng-show="assigned_user_id.mandatory">*</span>{{assigned_user_id.label}}</label>
                    <select class="form-control small-input col-sm-12" ng-model="assigned_user_id.fieldValue" name="assigned_user_id" ng-required="assigned_user_id.mandatory" ng-options="owner.value as owner.label for owner in owners">
                    </select>
                    <span class="validationtext" ng-show="form.assigned_user_id.$dirty && form.assigned_user_id.$invalid">
                      <span ng-show="form.assigned_user_id.$error.required">{{assigned_user_id.label}} is required.</span>
                    </span>
                  </div>
                  <div class="wgt-form-group clearfix">
                    <label class="fieldlabel" title="{{eventstatus.label}}"><span class="redColor mandatoryIndicator" ng-show="eventstatus.mandatory">*</span>{{eventstatus.label}}</label>
                    <select class="form-control small-input col-sm-12" ng-model="eventstatus.fieldValue" name="eventstatus" ng-required="eventstatus.mandatory" ng-options="picklistValue.value as picklistValue.label for picklistValue in eventstatus.type.picklistValues">
                    </select>
                    <span class="validationtext" ng-show="form.eventstatus.$dirty && form.eventstatus.$invalid">
                      <span ng-show="form.eventstatus.$error.required">{{eventstatus.label}} is required.</span>
                    </span>
                  </div>
                  <div class="wgt-form-group clearfix">
                    <label class="fieldlabel padding-left-zero col-sm-12" title="{{date_start.label}}"><span class="redColor mandatoryIndicator" ng-show="date_start.mandatory">*</span>{{date_start.label}}</label>
                    <div class="col-sm-6 padding-left-zero padding-right-one">
                      <span class="vtinput-prepend">
                        <input class="form-control small-input col-sm-12" name="date_start" type="text" ng-model="date_start.fieldValue" event-start-date data-activitytype="{{activitytype.fieldValue}}" data-start-time="{{time_start.fieldValue}}" name="date_start" ng-required="date_start.mandatory" />
                        <span class="vtinput-addon"><i class="fa fa-calendar"></i></span>
                      </span>
                    </div>
                    <div class="col-sm-6 padding-right-zero padding-left-one">
                      <span class="vtinput-prepend">
                        <input class="form-control small-input col-sm-12" type="text" name="time_start" class="time" ng-model="time_start.fieldValue" event-start-time data-activitytype="{{activitytype.fieldValue}}" data-start-date="{{date_start.fieldValue}}" name="time_start" ng-required="time_start.mandatory" />
                        <span class="vtinput-addon"><i class="fa fa-clock-o"></i></span>
                      </span>
                    </div>
                    <span class="validationtext" ng-show="(form.date_start.$dirty && form.time_start.$dirty) && (form.date_start.$invalid || form.time_start.$invalid)">
                      <span ng-show="form.date_start.$error.required || form.time_start.$error.required">{{date_start.label}} is required.</span>
                    </span>
                  </div>
                  <div class="wgt-form-group clearfix">
                    <label class="fieldlabel padding-left-zero col-sm-12" title="{{due_date.label}}"><span class="redColor mandatoryIndicator" ng-show="due_date.mandatory">*</span>{{due_date.label}}</label>
                    <div class="col-sm-6 padding-left-zero padding-right-one">
                      <span class="vtinput-prepend">
                        <input class="form-control small-input col-sm-12" type="text" name="due_date" ng-model="due_date.fieldValue" date-picker name="due_date" ng-required="due_date.mandatory" />
                        <span class="vtinput-addon"><i class="fa fa-calendar"></i></span>
                      </span>
                    </div>
                    <div class="col-sm-6 padding-right-zero padding-left-one">
                      <span class="vtinput-prepend">
                        <input class="form-control small-input col-sm-12" type="text" class="time" name="time_end" ng-model="time_end.fieldValue" time-picker name="time_end" ng-required="time_end.mandatory" />
                        <span class="vtinput-addon"><i class="fa fa-clock-o"></i></span>
                      </span>
                    </div>
                    <span class="validationtext" ng-show="(form.due_date.$dirty && form.time_end.$dirty) && (form.due_date.$invalid || form.time_end.$invalid)">
                      <span ng-show="form.due_date.$error.required || form.time_end.$error.required">{{due_date.label}} is required.</span>
                    </span>
                    <span class="validationtext" ng-show="!endDateTimeIsGreater">
                      <span ng-show="!endDateTimeIsGreater">{{due_date.label}} should be after {{date_start.label}}</span>
                    </span>
                  </div>
                  <div ng-repeat="field in formFields">
                    <div ng-switch on="field.type.name">
                      <div ng-switch-when="string">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                        </div>
                      </div>
                      <div ng-switch-when="email">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <input class="form-control small-input col-sm-12" type="email" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} required
                          </span>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.email">
                            Invalid email
                          </span>
                        </div>
                      </div>
                      <div ng-switch-when="phone">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                        </div>
                      </div>
                      <div ng-switch-when="owner">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <select class="form-control small-input col-sm-12" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-options="owner.value as owner.label for owner in owners">
                          </select>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                        </div>
                      </div>
                      <div ng-switch-when="picklist">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <select class="form-control small-input col-sm-12" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-options="picklistValue.value as picklistValue.label for picklistValue in field.type.picklistValues">
                          </select>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                        </div>
                      </div>
                      <div ng-switch-when="integer">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-pattern="/^\d+$/" />
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number || innerForm.fieldValue.$error.pattern">
                            Enter valid number
                          </span>
                        </div>
                      </div>
                      <div ng-switch-when="decimal">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number">
                            Enter valid number
                          </span>
                        </div>
                      </div>
                      <div ng-switch-when="date">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <span class="vtinput-prepend">
                            <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" date-picker name="fieldValue" ng-required="field.mandatory" />
                            <span class="vtinput-addon"><i class="fa fa-calendar"></i></span>
                          </span>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                        </div>
                      </div>
                      <div ng-switch-when="time">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <span class="vtinput-prepend">
                            <input class="form-control small-input col-sm-12" type="text" class="time" ng-model="field.fieldValue" time-picker name="fieldValue" ng-required="field.mandatory" />
                            <span class="vtinput-addon"><i class="fa fa-clock-o"></i></span>
                          </span>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                        </div>
                      </div>
                      <div ng-switch-when="multipicklist">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <ui-select multiple ng-model="field.fieldValue" theme="bootstrap" style="width: 100%;height: 100%;" name="fieldValue" ng-required="field.mandatory" ui-select-required>
                            <ui-select-match placeholder="">{{$item.label}}</ui-select-match>
                            <ui-select-choices repeat="picklistValue.value as picklistValue in  field.type.picklistValues| propsFilter: {label: $select.search}">
                              <div ng-bind-html="picklistValue.label | highlight: $select.search"></div>
                            </ui-select-choices>
                          </ui-select>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                        </div>
                      </div>
                      <div ng-switch-when="url">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-pattern="/\w+\.\w+/" />
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.pattern">
                            Enter valid Url
                          </span>
                        </div>
                      </div>
                      <div ng-switch-when="skype">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                        </div>
                      </div>
                      <div ng-switch-when="boolean">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <input class="form-control" type="checkbox" ng-model="field.fieldValue" name="fieldValue" ng-true-value="'1'" ng-false-value="'0'" ng-required="field.mandatory" />
                        </div>
                        <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                          {{field.label}} is required
                        </span>
                      </div>
                      <div ng-switch-when="text">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <textarea class="form-control col-sm-12 textarea-field commentbox" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory"></textarea>
                        </div>
                        <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                          {{field.label}} is required
                        </span>
                      </div>
                      <div ng-switch-when="double">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" min="0" max="100" ng-minlength="0" ng-maxlength="100" />
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number || innerForm.fieldValue.$error.min || innerForm.fieldValue.$error.max">
                            Enter valid Percentage
                          </span>
                        </div>
                      </div>
                      <div ng-switch-when="currency">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <span class="vtinput-prepend">
                            <span class="vtinput-addon">{{userpreferences.currency_symbol}}</span>
                            <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                          </span>
                          <span class="validationtext" ng-show="innerForm.$dirty &&  innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number">
                            Enter valid number
                          </span>
                        </div>
                      </div>
                      <div ng-switch-when="multicurrency">
                        <div class="wgt-form-group clearfix" ng-form="innerForm">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <span class="vtinput-prepend">
                            <span class="vtinput-addon">{{userpreferences.currency_symbol}}</span>
                            <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                          </span>
                          <span class="validationtext" ng-show="innerForm.$dirty &&  innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number">
                            Enter valid number
                          </span>
                        </div>
                      </div>
                      <div ng-switch-when="reference">
                        <div class="wgt-form-group clearfix" ng-form="innerForm" ng-init="referenceModuleName='{{field.type.refersTo[0]}}'">
                          <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                          <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" ng-focus="setCurrentReferenceModuleName(field.type.refersTo[0])" name="fieldValue" placeholder="Type to search" typeahead="record as record.label for record in getReferenceRecords($viewValue)" typeahead-editable="true" typeahead-min-length="3" ng-required="field.mandatory">
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="fieldgroup wgt-form-group clearfix" ng-show="eventstatus.fieldValue == 'Held'" ng-form="innerForm">
                    <label class="fieldlabel" title="Hold Followup on">Hold Followup on</label>
                    <input type="checkbox" ng-model="followup" type="checkbox" name="followup" ng-true-value="'on'" ng-false-value="'off'">
                    <div class="col-sm-6 padding-left-zero padding-right-one">
                      <span class="vtinput-prepend">
                        <input class="form-control small-input col-sm-12" type="text" ng-model="followup_date_start" name="followup_date_start" data-start-time="{{time_start.fieldValue}}" date-picker ng-required="followup === 'on'" />
                        <span class="vtinput-addon"><i class="fa fa-calendar"></i></span>
                      </span>
                    </div>
                    <div class="col-sm-6 padding-right-zero padding-left-one">
                      <span class="vtinput-prepend">
                        <input class="form-control small-input col-sm-12" type="text" class="time" ng-model="followup_time_start" time-picker name="followup_time_start" ng-required="followup === 'on'" />
                        <span class="vtinput-addon"><i class="fa fa-clock-o"></i></span>
                      </span>
                    </div>
                    <span class="validationtext" ng-show="followup == 'on'">
                      <span ng-show="innerForm.followup_date_start.$error.required || innerForm.followup_time_start.$error.required">Followup date time is required.</span>
                    </span>
                    <span class="validationtext" ng-show="followup == 'on'">
                      <span ng-show="followupValidationError">Followup date time should be greater than or equal to start date time</span>
                    </span>
                  </div>
                  <div class="validationtext animate-show" ng-show="showValidationMsg">
                    Invalid inputs provided
                  </div>
                  <div class="form-group wgt-form-group clearfix formButtons editFormButtonGroup" style="margin-top: 16px;text-align: center;">
                    <button type="submit" class="btn btn-primary btn-xs somemargintop">Save</button>
                    <a class="somemargintop red-color cursor-pointer formcancellink" ng-click="closeForm()">Cancel</a>
                  </div>
                </form>
              </div>
              <div ng-show="!showForm" class="wgt-list-view clearfix">
                <div class="wgt-list" ng-repeat="activity in upcomingActivities">
                  <div class="wgt-list-row" ng-init="showEditIcon = false" ng-mouseenter="showEditIcon = true && activity.activitytype !== 'Task'" ng-mouseleave="showEditIcon = false">
                    <div class="wgt-list-col wgt-list-title">
                      <i class="fa" ng-class="getActivityTypeIconClass(activity.activitytype)"></i>&nbsp;
                      <a href="{{activity.detailViewUrl}}" title="{{activity.subject}}" target="_blank">{{activity.subject}}</a>
                    </div>
                    <div class="wgt-list-col wgt-list-title col-right pull-right p-0">
                      <span ng-show="showEditIcon">
                        <i ng-show="hasCreatePermission" class="fa fa-pencil cursor-pointer action-icon" ng-click="editRecord(activity)" title="Edit"></i>
                      </span>
                    </div>
                  </div>
                  <div class="wgt-list-row">
                    <div class="wgt-list-col wgt-list-content">
                      <span>{{activity.start_date_time | formatDateTimeToLocalTimeZone}}</span>
                    </div>
                    <div class="wgt-list-col wgt-list-content pull-right">
                    </div>
                  </div>
                </div>
                <div class="no-data-message" ng-show="!upcomingActivities.length && !loading">No pending activities</div>
                <div ng-show="loading && !upcomingActivities.length">
                  <img src="<%= baseresourceurl%>assets/images/load.gif" style="display: block; margin-right: auto; margin-left: auto;">
                </div>
              </div>
            </div>
          </div>
          <div class="tab-content emailstab" ng-show="tab === 'emails'">
            <div ng-controller="EmailsController">
              <div class="listviewheadercontainer">
                <span class="title">Emails</span>
              </div>
              <div class="wgt-list-view clearfix">
                <div class="wgt-list" ng-repeat="email in relatedEmails">
                  <div class="wgt-list-row">
                    <div class="wgt-list-col wgt-list-title">
                      <span>{{email.assigned_user_id.label}}</span>
                    </div>
                    <div class="wgt-list-col wgt-list-title pull-right">
                    </div>
                  </div>
                  <div class="wgt-list-row">
                    <div class="wgt-list-col wgt-list-title">
                      <a target="_blank" title="{{email.label}}" href={{email.detailViewUrl}}>{{email.label}} </a>&nbsp;
                      <i class="fa fa-caret-right cursor-pointer openEmail" toggle-email-content></i>
                      <i style="display:none;" class="fa fa-caret-down cursor-pointer closeEmail" toggle-email-content></i>
                    </div>
                    <div class="wgt-list-col wgt-list-title pull-right">
                    </div>
                  </div>
                  <div class="wgt-list-row">
                    <div class="wgt-list-col wgt-list-title">
                      <div class="emailcontent" ng-bind-html="email.description"></div>
                    </div>
                    <div class="wgt-list-col wgt-list-title pull-right">
                    </div>
                  </div>
                </div>
                <div class="no-data-message" ng-show="!relatedEmails.length && !loading">No related emails</div>
                <div ng-show="loading && !relatedEmails.length">
                  <img src="<%= baseresourceurl%>assets/images/load.gif" style="display: block; margin-right: auto; margin-left: auto;">
                </div>
              </div>
            </div>
          </div>
          <div class="tab-content quotestab" ng-show="tab === 'quotes'">
            <div ng-controller="QuotesController">
              <div class="listviewheadercontainer">
                <span class="title">Quotes</span>
              </div>
              <div class="wgt-list-view clearfix">
                <div class="wgt-list" ng-repeat="quote in relatedQuotes">
                  <div class="wgt-list-row">
                    <div class="wgt-list-col wgt-list-title">
                      <a href="{{quote.detailViewUrl}}" title="{{quote.label}}" target="_blank">{{quote.label}}</a>
                    </div>
                    <div class="wgt-list-col wgt-list-title pull-right">
                      <span>{{userpreferences.currency_symbol}} {{quote.hdnGrandTotal}}</span>
                    </div>
                  </div>
                  <div class="wgt-list-row">
                    <div class="wgt-list-col wgt-list-content">
                      <span class="label" ng-class="getLabelClass(quote.quotestage)">{{quote.quotestage}}</span>
                    </div>
                    <div class="wgt-list-col wgt-list-content pull-right">
                    </div>
                  </div>
                </div>
                <div class="no-data-message" ng-show="!relatedQuotes.length && !loading">No related quotes</div>
                <div ng-show="loading && !relatedQuotes.length">
                  <img src="<%= baseresourceurl%>assets/images/load.gif" style="display: block; margin-right: auto; margin-left: auto;">
                </div>
              </div>
            </div>
          </div>
          <div class="tab-content invoicestab" ng-show="tab === 'invoices'">
            <div ng-controller="InvoicesController">
              <div class="listviewheadercontainer">
                <span class="title">Invoices</span>
              </div>
              <div class="wgt-list-view clearfix">
                <div class="wgt-list" ng-repeat="invoice in relatedInvoices">
                  <div class="wgt-list-row">
                    <div class="wgt-list-col wgt-list-title">
                      <a href="{{invoice.detailViewUrl}}" title="{{invoice.label}}" target="_blank">{{invoice.label}}</a>
                    </div>
                    <div class="wgt-list-col wgt-list-title pull-right col-right">
                      <span class="break-word">{{userpreferences.currency_symbol}} {{invoice.hdnGrandTotal}}</span>
                    </div>
                  </div>
                  <div class="wgt-list-row">
                    <div class="wgt-list-col wgt-list-content">
                      <span class="label" ng-class="getLabelClass(invoice.invoicestatus)">{{invoice.invoicestatus}}</span>
                    </div>
                    <div class="wgt-list-col wgt-list-content pull-right">
                    </div>
                  </div>
                </div>
                <div class="no-data-message" ng-show="!relatedInvoices.length && !loading">No related invoices</div>
                <div ng-show="loading && !relatedInvoices.length">
                  <img src="<%= baseresourceurl%>assets/images/load.gif" style="display: block; margin-right: auto; margin-left: auto;">
                </div>
              </div>
            </div>
          </div>
          <div class="tab-content opportunitiestab" ng-show="tab === 'opportunities'">
            <div ng-controller="OpportunitiesController">
              <div ng-controller="OpportunitiesListViewController" ng-show="subview === 'list'">
                <div class="listviewheadercontainer">
                  <span class="title" ng-show="mode !== 'edit' && !showForm">Opportunities</span>
                  <span class="title" ng-show="mode !== 'edit' && showForm">Creating Opportunity</span>
                  <span class="title" ng-show="mode === 'edit'">Editing Opportunity</span>
                  <i ng-show="showForm === false && hasCreatePermission" class="add-record-icon fa fa-plus pull-right cursor-pointer" ng-click="showCreateForm()" title="Add Opportunity"></i>
                </div>
                <div class="createOpportunityForm animate-show clearfix" ng-show="showForm">
                  <form ng-submit="create(form.$valid)" name="form" novalidate class="moduleCreateForm clearfix" ng-show="potentialname && formFields">
                    <div class="wgt-form-group clearfix">
                      <label class="fieldlabel" title="{{potentialname.label}}"><span class="redColor mandatoryIndicator" ng-show="potentialname.mandatory">*</span>{{potentialname.label}}</label>
                      <input class="form-control small-input col-sm-12" type="text" ng-model="potentialname.fieldValue" name="potentialname" ng-required="potentialname.mandatory" />
                      <span class="validationtext" ng-show="form.potentialname.$dirty && form.potentialname.$invalid">
                        <span ng-show="form.potentialname.$error.required">{{potentialname.label}} is required.</span>
                      </span>
                    </div>
                    <div class="wgt-form-group clearfix padding-left-zero padding-right-one" ng-show="amount">
                      <label class="fieldlabel" title="{{amount.label}}"><span class="redColor mandatoryIndicator" ng-show="amount.mandatory">*</span>{{amount.label}}</label>
                      <span class="vtinput-prepend">
                        <span class="vtinput-addon">{{userpreferences.currency_symbol}}</span>
                        <input class="form-control small-input col-sm-12" type="number" ng-model="amount.fieldValue" name="amount" ng-required="amount.mandatory" />
                      </span>
                      <span class="validationtext" ng-show="form.amount.$dirty && form.amount.$invalid">
                        <span ng-show="form.amount.$error.required">{{potentialname.label}} is required.</span>
                      </span>
                      <span class="validationtext" ng-show="form.amount.$dirty && form.amount.$error.number">
                        Enter valid number
                      </span>
                    </div>
                    <div class="wgt-form-group clearfix padding-right-zero padding-left-one" ng-show="sales_stage">
                      <label class="fieldlabel" title="{{sales_stage.label}}"><span class="redColor mandatoryIndicator" ng-show="sales_stage.mandatory">*</span>{{sales_stage.label}}</label>
                      <select class="form-control small-input col-sm-12" ng-model="sales_stage.fieldValue" name="sales_stage" ng-required="sales_stage.mandatory" ng-options="picklistValue.value as picklistValue.label for picklistValue in sales_stage.type.picklistValues">
                      </select>
                      <span class="validationtext" ng-show="form.sales_stage.$dirty && form.sales_stage.$invalid">
                        <span ng-show="form.sales_stage.$error.required">{{sales_stage.label}} is required.</span>
                      </span>
                    </div>
                    <div class="wgt-form-group clearfix padding-right-zero padding-left-one" ng-show="closingdate">
                      <label class="fieldlabel" title="{{closingdate.label}}"><span class="redColor mandatoryIndicator" ng-show="closingdate.mandatory">*</span>{{closingdate.label}}</label>
                      <span class="vtinput-prepend">
                        <input class="form-control small-input col-sm-12" type="text" ng-model="closingdate.fieldValue" date-picker name="closingdate" ng-required="closingdate.mandatory" />
                        <span class="vtinput-addon"><i class="fa fa-calendar"></i></span>
                      </span>
                      <span class="validationtext" ng-show="form.closingdate.$dirty && form.closingdate.$invalid">
                        <span ng-show="form.closingdate.$error.required">{{closingdate.label}} is required.</span>
                      </span>
                    </div>
                    <div ng-show="leadsource" class="wgt-form-group clearfix padding-right-zero padding-left-one">
                      <label class="fieldlabel" title="{{leadsource.label}}"><span class="redColor mandatoryIndicator" ng-show="leadsource.mandatory">*</span>{{leadsource.label}}</label>
                      <select class="form-control small-input col-sm-12" ng-model="leadsource.fieldValue" name="leadsource" ng-required="leadsource.mandatory" ng-options="picklistValue.value as picklistValue.label for picklistValue in leadsource.type.picklistValues">
                      </select>
                      <span class="validationtext" ng-show="form.leadsource.$dirty && form.leadsource.$invalid">
                        <span ng-show="form.leadsource.$error.required">{{leadsource.label}} is required.</span>
                      </span>
                    </div>
                    <div class="wgt-form-group clearfix padding-right-zero padding-left-one">
                      <label class="fieldlabel" title="{{assigned_user_id.label}}"><span class="redColor mandatoryIndicator" ng-show="assigned_user_id.mandatory">*</span>{{assigned_user_id.label}}</label>
                      <select class="form-control small-input col-sm-12" ng-model="assigned_user_id.fieldValue" name="assigned_user_id" ng-required="assigned_user_id.mandatory" ng-options="owner.value as owner.label for owner in owners">
                      </select>
                      <span class="validationtext" ng-show="form.assigned_user_id.$dirty && form.assigned_user_id.$invalid">
                        <span ng-show="form.assigned_user_id.$error.required">{{assigned_user_id.label}} is required.</span>
                      </span>
                    </div>
                    <div class="wgt-form-group clearfix padding-right-zero padding-left-one" ng-show="opportunity_type">
                      <label class="fieldlabel" title="{{opportunity_type.label}}"><span class="redColor mandatoryIndicator" ng-show="opportunity_type.mandatory">*</span>{{opportunity_type.label}}</label>
                      <select class="form-control small-input col-sm-12" ng-model="opportunity_type.fieldValue" name="opportunity_type" ng-required="opportunity_type.mandatory" ng-options="picklistValue.value as picklistValue.label for picklistValue in opportunity_type.type.picklistValues">
                      </select>
                      <span class="validationtext" ng-show="form.opportunity_type.$dirty && form.opportunity_type.$invalid">
                        <span ng-show="form.opportunity_type.$error.required">{{opportunity_type.label}} is required.</span>
                      </span>
                    </div>
                    <div ng-repeat="field in formFields">
                      <div ng-switch on="field.type.name">
                        <div ng-switch-when="string">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="email">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="email" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.email">
                              Invalid email
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="phone">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="owner">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <select class="form-control small-input col-sm-12" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-options="owner.value as owner.label for owner in owners">
                            </select>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="picklist">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <select class="form-control small-input col-sm-12" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-options="picklistValue.value as picklistValue.label for picklistValue in field.type.picklistValues">
                            </select>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="integer">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-pattern="/^\d+$/" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number || innerForm.fieldValue.$error.pattern">
                              Enter valid number
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="decimal">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number">
                              Enter valid number
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="date">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <span class="vtinput-prepend">
                              <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" date-picker name="fieldValue" ng-required="field.mandatory" />
                              <span class="vtinput-addon"><i class="fa fa-calendar"></i></span>
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="time">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <span class="vtinput-prepend">
                              <input class="form-control small-input col-sm-12" type="text" class="time" ng-model="field.fieldValue" time-picker name="fieldValue" ng-required="field.mandatory" />
                              <span class="vtinput-addon"><i class="fa fa-clock-o"></i></span>
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="multipicklist">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <ui-select multiple ng-model="field.fieldValue" theme="bootstrap" style="width: 100%;height: 100%;" name="fieldValue" ng-required="field.mandatory" ui-select-required>
                              <ui-select-match placeholder="">{{$item.label}}</ui-select-match>
                              <ui-select-choices repeat="picklistValue.value as picklistValue in  field.type.picklistValues| propsFilter: {label: $select.search}">
                                <div ng-bind-html="picklistValue.label | highlight: $select.search"></div>
                              </ui-select-choices>
                            </ui-select>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="url">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-pattern="/\w+\.\w+/" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.pattern">
                              Enter valid Url
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="skype">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="boolean">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control" type="checkbox" ng-model="field.fieldValue" name="fieldValue" ng-true-value="'1'" ng-false-value="'0'" ng-required="field.mandatory" />
                          </div>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                        </div>
                        <div ng-switch-when="text">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <textarea class="form-control col-sm-12 textarea-field" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory"></textarea>
                          </div>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                        </div>
                        <div ng-switch-when="double">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" min="0" max="100" ng-minlength="0" ng-maxlength="100" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number || innerForm.fieldValue.$error.min || innerForm.fieldValue.$error.max">
                              Enter valid Percentage
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="currency">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <span class="vtinput-prepend">
                              <span class="vtinput-addon">{{userpreferences.currency_symbol}}</span>
                              <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty &&  innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number">
                              Enter valid number
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="multicurrency">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <span class="vtinput-prepend">
                              <span class="vtinput-addon">{{userpreferences.currency_symbol}}</span>
                              <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty &&  innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number">
                              Enter valid number
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="reference">
                          <div class="wgt-form-group clearfix" ng-form="innerForm" ng-init="referenceModuleName='{{field.type.refersTo[0]}}'">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" ng-focus="setCurrentReferenceModuleName(field.type.refersTo[0])" name="fieldValue" placeholder="Type to search" typeahead="record as record.label for record in getReferenceRecords($viewValue)" typeahead-editable="true" typeahead-min-length="3" ng-required="field.mandatory">
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="validationtext animate-show" ng-show="showValidationMsg">
                      Invalid inputs provided
                    </div>
                    <div class="form-group wgt-form-group clearfix formButtons editFormButtonGroup" style="margin-top: 16px;text-align: center;">
                      <button type="submit" class="btn btn-primary btn-xs somemargintop">Save</button>
                      <a class="somemargintop red-color cursor-pointer formcancellink" ng-click="closeForm()">Cancel</a>
                    </div>
                  </form>
                </div>
                <div ng-show="!showForm" class="wgt-list-view clearfix">
                  <div class="wgt-list" ng-repeat="opportunity in relatedOpportunities">
                    <div class="wgt-list-row" ng-init="showEditIcon = false" ng-mouseenter="showEditIcon = true" ng-mouseleave="showEditIcon = false">
                      <div class="wgt-list-col wgt-list-title">
                        <a href="{{opportunity.detailViewUrl}}" title="{{opportunity.label}}" target="_blank">{{opportunity.label}}</a> <i style="cursor: pointer;" class="fa fa-link" title="Link email to this Opportunity" ng-controller="AttachEmailController" ng-really-click="attachEmail(undefined, opportunity)" ng-really-message="Do you want to archive this email to Repbox?"></i>
                      </div>
                      <div class="wgt-list-col wgt-list-title pull-right col-right p-0">
                        <span ng-show="!showEditIcon && opportunity.amount">{{userpreferences.currency_symbol}} {{opportunity.amount | number:2}}</span>
                        <span ng-show="showEditIcon">
                          <i ng-show="hasCreatePermission" class="fa fa-pencil cursor-pointer action-icon" ng-click="editRecord(opportunity)" title="Edit"></i>
                          <i class="fa fa-comments cursor-pointer action-icon" ng-click="showDetails(opportunity)" title="Comment"></i>
                        </span>
                      </div>
                    </div>
                    <div class="wgt-list-row">
                      <div class="wgt-list-col wgt-list-content">
                        <span class="label" ng-class="getLabelClass(opportunity.sales_stage)">{{opportunity.sales_stage}}</span>
                      </div>
                      <div class="wgt-list-col wgt-list-content pull-right col-right">
                        <span>{{opportunity.closingdate | date_format}}</span>
                      </div>
                    </div>
                    <!--<div class="wgt-list-row">
                                                <div class="wgt-list-col wgt-list-content">
                                                    <span>{{opportunity.contact_id.label}}</span>
                                                </div>
                                                <div class="wgt-list-col wgt-list-content pull-right col-right">
                                                    <span>{{opportunity.related_to.label}}</span>
                                                </div>
                                            </div>-->
                  </div>
                  <div class="no-data-message" ng-show="!relatedOpportunities.length && !loading && !showForm">No related opportunities</div>
                  <div ng-show="loading && !relatedOpportunities.length">
                    <img src="<%= baseresourceurl%>assets/images/load.gif" style="display: block; margin-right: auto; margin-left: auto;">
                  </div>
                </div>
              </div>
              <div ng-controller="OpportunitiesDetailViewController" ng-show="subview === 'detail'">
                <div class="navigationbar">
                  <span class="cursor-pointer navigationtext" ng-click="changeSubView('list')"><i class="fa fa-arrow-left"></i> Back</span>
                </div>
                <div class="recordDetails">
                  <div class="wgt-detail-view clearfix">
                    <div class="wgt-detail">
                      <div class="wgt-detail-row">
                        <div class="wgt-detail-col wgt-detail-title">
                          <a href="{{record.detailViewUrl}}" target="_blank">{{record.label}}</a>
                        </div>
                        <div class="wgt-detail-col col-right wgt-detail-title pull-right" ng-show="record.amount">
                          <span>{{userpreferences.currency_symbol}} {{record.amount}}</span>
                        </div>
                      </div>
                      <div class="wgt-detail-row">
                        <div class="wgt-detail-col wgt-detail-content">
                          <span class="label" ng-class="getLabelClass(record.sales_stage)">{{record.sales_stage}}</span>
                        </div>
                        <div class="wgt-detail-col col-right wgt-detail-content pull-right">
                          <span>{{record.closingdate | date_format}}</span>
                        </div>
                      </div>
                      <!--<div class="wgt-detail-row">
                                                    <div class="wgt-detail-col wgt-detail-content">
                                                        <span>{{record.contact_id.label}}</span>
                                                    </div>
                                                    <div class="wgt-detail-col col-right wgt-detail-content pull-right">
                                                        <span>{{record.related_to.label}}</span>
                                                    </div>
                                                </div>-->
                    </div>
                  </div>
                </div>
                <div class="commentspanel">
                  <div>
                    <form ng-submit="postComment()">
                      <textarea placeholder="Add your comment here.." class="commentbox" ng-model="newcomment"></textarea>
                      <button class="btn btn-primary btn-xs pull-right" type="submit" ng-disabled="!newcomment.length">Add Comment</button>
                    </form>
                  </div>
                  <div class="wgt-list-view clearfix">
                    <div scroll-me="{'height':'280px','start':'top'}">
                      <div class="wgt-list comment" ng-repeat="comment in relatedcomments | reverse">
                        <div class="wgt-list-row">
                          <div class="wgt-list-col wgt-list-content-md">
                            <span class="comment-username">{{comment.assigned_user_id.label}}</span>
                          </div>
                          <div class="wgt-list-col wgt-list-content-sm pull-right">
                            <span><i class="fa fa-clock-o"></i> {{comment.modifiedtime | formatDateTimeToLocalTimeZone}}</span>
                          </div>
                        </div>
                        <div class="wgt-list-row commentcontent">
                          <div class="wgt-list-col wgt-list-content" style="max-width:100%;white-space: pre-line;margin-top: -15px;">
                            <span class="comment-content" ng-bind-html="comment.commentcontent"></span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-content casestab" ng-show="tab === 'cases'">
            <div ng-controller="CasesController">
              <div ng-controller="CasesListViewController" ng-show="subview === 'list'">
                <div class="listviewheadercontainer">
                  <span class="title" ng-show="mode !== 'edit' && !showForm">Cases</span>
                  <span class="title" ng-show="mode !== 'edit' && showForm">Creating Case</span>
                  <span class="title" ng-show="mode === 'edit'">Editing Case</span>
                  <i ng-show="showForm === false && hasCreatePermission" class="add-record-icon fa fa-plus pull-right cursor-pointer" ng-click="showCreateForm()" title="Add Case"></i>
                </div>
                <div class="createcaseformcontainer animate-show" ng-show="showForm">
                  <form ng-submit="create(form.$valid)" name="form" novalidate class="moduleCreateForm clearfix" ng-show="title && formFields">
                    <div class="wgt-form-group clearfix" ng-show="description">
                      <label class="fieldlabel padding-left-zero col-sm-12" title="{{description.label}}"><span class="redColor mandatoryIndicator" ng-show="description.mandatory">*</span>{{description.label}}</label>
                      <textarea class="form-control col-sm-12 commentbox" ng-model="description.fieldValue" ng-required="description.mandatory"></textarea>
                    </div>
                    <div class="wgt-form-group clearfix">
                      <label class="fieldlabel" title="{{title.label}}"><span class="redColor mandatoryIndicator" ng-show="title.mandatory">*</span>{{title.label}}</label>
                      <input class="form-control small-input col-sm-12" type="text" ng-model="title.fieldValue" name="title" ng-required="title.mandatory" />
                      <span class="validationtext" ng-show="form.title.$dirty && form.title.$invalid">
                        <span ng-show="form.title.$error.required">{{title.label}} is required.</span>
                      </span>
                    </div>
                    <div class="wgt-form-group clearfix padding-left-zero padding-right-one">
                      <label class="fieldlabel" title="{{casestatus.label}}"><span class="redColor mandatoryIndicator" ng-show="casestatus.mandatory">*</span>{{casestatus.label}}</label>
                      <select class="form-control small-input col-sm-12" ng-model="casestatus.fieldValue" name="casestatus" ng-required="casestatus.mandatory" ng-options="picklistValue.value as picklistValue.label for picklistValue in casestatus.type.picklistValues">
                      </select>
                      <span class="validationtext" ng-show="form.casestatus.$dirty && form.casestatus.$invalid">
                        <span ng-show="form.casestatus.$error.required">{{casestatus.label}} is required.</span>
                      </span>
                    </div>
                    <div class="wgt-form-group clearfix padding-right-zero padding-left-one">
                      <label class="fieldlabel" title="{{casepriority.label}}"><span class="redColor mandatoryIndicator" ng-show="casepriority.mandatory">*</span>{{casepriority.label}}</label>
                      <select class="form-control small-input col-sm-12" ng-model="casepriority.fieldValue" name="casepriority" ng-required="casepriority.mandatory" ng-options="picklistValue.value as picklistValue.label for picklistValue in casepriority.type.picklistValues">
                      </select>
                      <span class="validationtext" ng-show="form.casepriority.$dirty && form.casepriority.$invalid">
                        <span ng-show="form.casepriority.$error.required">{{casepriority.label}} is required.</span>
                      </span>
                    </div>
                    <div class="wgt-form-group clearfix">
                      <label class="fieldlabel" title="{{assigned_user_id.label}}"><span class="redColor mandatoryIndicator" ng-show="assigned_user_id.mandatory">*</span>{{assigned_user_id.label}}</label>
                      <select class="form-control small-input col-sm-12" ng-model="assigned_user_id.fieldValue" name="assigned_user_id" ng-required="assigned_user_id.mandatory" ng-options="owner.value as owner.label for owner in owners">
                      </select>
                      <span class="validationtext" ng-show="form.assigned_user_id.$dirty && form.assigned_user_id.$invalid">
                        <span ng-show="form.assigned_user_id.$error.required">{{assigned_user_id.label}} is required.</span>
                      </span>
                    </div>
                    <div ng-repeat="field in formFields">
                      <div ng-switch on="field.type.name">
                        <div ng-switch-when="string">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="email">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="email" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.email">
                              Invalid email
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="phone">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="owner">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <select class="form-control small-input col-sm-12" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory">
                              <option ng-repeat="owner in owners" value="{{owner.value}}">{{owner.label}}</option>
                            </select>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="ownergroup">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <select class="form-control small-input col-sm-12" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory">
                              <option ng-repeat="group in groups" value="{{group.value}}">{{group.label}}</option>
                            </select>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="picklist">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <select class="form-control small-input col-sm-12" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-options="picklistValue.value as picklistValue.label for picklistValue in field.type.picklistValues">
                            </select>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="integer">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-pattern="/^\d+$/" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number || innerForm.fieldValue.$error.pattern">
                              Enter valid number
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="decimal">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number">
                              Enter valid number
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="date">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <span class="vtinput-prepend">
                              <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" date-picker name="fieldValue" ng-required="field.mandatory" />
                              <span class="vtinput-addon"><i class="fa fa-calendar"></i></span>
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="time">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <span class="vtinput-prepend">
                              <input class="form-control small-input col-sm-12" type="text" class="time" ng-model="field.fieldValue" time-picker name="fieldValue" ng-required="field.mandatory" />
                              <span class="vtinput-addon"><i class="fa fa-clock-o"></i></span>
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="multipicklist">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <ui-select multiple ng-model="field.fieldValue" theme="bootstrap" style="width: 100%;height: 100%;" name="fieldValue" ng-required="field.mandatory" ui-select-required>
                              <ui-select-match placeholder="">{{$item.label}}</ui-select-match>
                              <ui-select-choices repeat="picklistValue.value as picklistValue in  field.type.picklistValues| propsFilter: {label: $select.search}">
                                <div ng-bind-html="picklistValue.label | highlight: $select.search"></div>
                              </ui-select-choices>
                            </ui-select>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="url">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-pattern="/\w+\.\w+/" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.pattern">
                              Enter valid Url
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="skype">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="boolean">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control" type="checkbox" ng-model="field.fieldValue" name="fieldValue" ng-true-value="'1'" ng-false-value="'0'" ng-required="field.mandatory" />
                          </div>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                        </div>
                        <div ng-switch-when="text">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <textarea class="form-control col-sm-12 textarea-field" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory"></textarea>
                          </div>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                        </div>
                        <div ng-switch-when="double">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" min="0" max="100" ng-minlength="0" ng-maxlength="100" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number || innerForm.fieldValue.$error.min || innerForm.fieldValue.$error.max">
                              Enter valid Percentage
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="currency">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <span class="vtinput-prepend">
                              <span class="vtinput-addon">{{userpreferences.currency_symbol}}</span>
                              <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty &&  innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number">
                              Enter valid number
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="multicurrency">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <span class="vtinput-prepend">
                              <span class="vtinput-addon">{{userpreferences.currency_symbol}}</span>
                              <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty &&  innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number">
                              Enter valid number
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="reference">
                          <div class="wgt-form-group clearfix" ng-form="innerForm" ng-init="referenceModuleName='{{field.type.refersTo[0]}}'">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" ng-focus="setCurrentReferenceModuleName(field.type.refersTo[0])" name="fieldValue" placeholder="Type to search" typeahead="record as record.label for record in getReferenceRecords($viewValue)" typeahead-editable="true" typeahead-min-length="3" ng-required="field.mandatory">
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="validationtext animate-show" ng-show="showValidationMsg">
                      Invalid inputs provided
                    </div>
                    <div class="form-group wgt-form-group clearfix formButtons editFormButtonGroup" style="margin-top: 16px;text-align: center;">
                      <button type="submit" class="btn btn-primary btn-xs somemargintop">Save</button>
                      <a class="somemargintop red-color cursor-pointer formcancellink" ng-click="closeForm()">Cancel</a>
                    </div>
                  </form>
                </div>
                <div ng-show="!showForm" class="wgt-list-view clearfix">
                  <div class="wgt-list" ng-repeat="case in relatedCases" ng-init="showEditIcon" ng-mouseenter="showEditIcon = true" ng-mouseleave="showEditIcon = false">
                    <div class="wgt-list-row">
                      <div class="wgt-list-col wgt-list-title">
                        <a href="{{case.detailViewUrl}}" title="{{case.label}}" target="_blank">{{case.label}}</a> <i style="cursor: pointer;" class="fa fa-link" title="Link email to this Case" ng-controller="AttachEmailController" ng-really-click="attachEmail(undefined, case)" ng-really-message="Do you want to archive this email to Repbox?"></i>
                      </div>
                      <div class="wgt-list-col wgt-list-title pull-right p-0">
                        <span ng-show="showEditIcon">
                          <i ng-show="hasCreatePermission" class="fa fa-pencil cursor-pointer action-icon" ng-click="editRecord(case)" title="Edit"></i>
                          <i class="fa fa-comments cursor-pointer action-icon" ng-click="showDetails(case)" title="Comment"></i>
                        </span>
                      </div>
                    </div>
                    <div class="wgt-list-row">
                      <div class="wgt-list-col wgt-list-content">
                        <span class="label" ng-class="getLabelClass(case.casestatus)">{{case.casestatus}}</span>
                      </div>
                      <div class="wgt-list-col wgt-list-content pull-right col-right">
                        <span>{{case.casepriority}}</span>
                      </div>
                    </div>
                  </div>
                  <div class="no-data-message" ng-show="!relatedCases.length && !loading && !showForm">No related cases</div>
                  <div ng-show="loading && !relatedCases.length">
                    <img src="<%= baseresourceurl%>assets/images/load.gif" style="display: block; margin-right: auto; margin-left: auto;">
                  </div>
                </div>
              </div>
              <div ng-controller="CasesDetailViewController" ng-show="subview === 'detail'">
                <div class="navigationbar">
                  <span class="cursor-pointer navigationtext" ng-click="changeSubView('list')"><i class="fa fa-arrow-left"></i> Back</span>
                </div>
                <div class="recordDetails">
                  <div class="wgt-detail-view clearfix">
                    <div class="wgt-detail">
                      <div class="wgt-detail-row">
                        <div class="wgt-detail-col wgt-detail-title">
                          <a href="{{record.detailViewUrl}}" target="_blank">{{record.label}}</a>
                        </div>
                        <div class="wgt-detail-col col-right wgt-detail-title pull-right">
                        </div>
                      </div>
                      <div class="wgt-detail-row">
                        <div class="wgt-detail-col wgt-detail-content">
                          <span class="label" ng-class="getLabelClass(record.casestatus)">{{record.casestatus}}</span>
                        </div>
                        <div class="wgt-detail-col wgt-detail-content pull-right col-right">
                          <span>{{record.casepriority}}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="commentspanel">
                  <div>
                    <form ng-submit="postComment()">
                      <textarea placeholder="Add your comment here.." class="commentbox" ng-model="newcomment"></textarea>
                      <button class="btn btn-primary btn-xs pull-right" type="submit" ng-disabled="!newcomment.length">Add Comment</button>
                      <button class="btn btn-primary btn-xs pull-right" ng-disabled="!newcomment.length" ng-click="reply()">Reply</button>
                    </form>
                  </div>
                  <div class="wgt-list-view clearfix">
                    <div scroll-me="{'height':'280px','start':'top'}">
                      <div class="wgt-list comment" ng-repeat="comment in relatedcomments | reverse">
                        <div class="wgt-list-row">
                          <div class="wgt-list-col wgt-list-content-md">
                            <span class="comment-username">{{comment.ownerlabel}}</span>
                          </div>
                          <div class="wgt-list-col wgt-list-content-sm pull-right">
                            <span style="margin-right:4px;"><i class="fa fa-clock-o"></i> {{comment.modifiedtime | formatDateTimeToLocalTimeZone}}</span>
                            <i class="pull-right fa" ng-class="{'fa-comments' : comment.is_private === '1', 'fa-envelope' : comment.is_private === '0'}"></i>
                          </div>
                        </div>
                        <div class="wgt-list-row commentcontent">
                          <div class="wgt-list-col wgt-list-content" style="max-width:100%;white-space: pre-line;margin-top: -15px;">
                            <span class="comment-content" ng-bind-html="comment.commentcontent"></span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-content helpdesktab" ng-show="tab === 'helpdesk'">
            <div ng-controller="HelpdeskController">
              <div ng-controller="HelpdeskListViewController" ng-show="subview === 'list'">
                <div class="listviewheadercontainer">
                  <span class="title" ng-show="mode !== 'edit' && !showForm">Tickets</span>
                  <span class="title" ng-show="mode !== 'edit' && showForm">Creating Ticket</span>
                  <span class="title" ng-show="mode === 'edit'">Editing Ticket</span>
                  <i ng-show="showForm === false && hasCreatePermission" class="add-record-icon fa fa-plus pull-right cursor-pointer" ng-click="showCreateForm()" title="Add Ticket"></i>
                </div>
                <div class="createticketformcontainer animate-show" ng-show="showForm">
                  <form ng-submit="create(form.$valid)" name="form" novalidate class="moduleCreateForm clearfix" ng-show="ticket_title && formFields">
                    <div class="wgt-form-group clearfix">
                      <label class="fieldlabel" title="{{ticket_title.label}}"><span class="redColor mandatoryIndicator" ng-show="ticket_title.mandatory">*</span>{{ticket_title.label}}</label>
                      <input class="form-control small-input col-sm-12" type="text" ng-model="ticket_title.fieldValue" name="ticket_title" ng-required="ticket_title.mandatory" />
                      <span class="validationtext" ng-show="form.ticket_title.$dirty && form.ticket_title.$invalid">
                        <span ng-show="form.ticket_title.$error.required">{{ticket_title.label}} is required.</span>
                      </span>
                    </div>
                    <div class="wgt-form-group clearfix padding-left-zero padding-right-one">
                      <label class="fieldlabel" title="{{ticketstatus.label}}"><span class="redColor mandatoryIndicator" ng-show="ticketstatus.mandatory">*</span>{{ticketstatus.label}}</label>
                      <select class="form-control small-input col-sm-12" ng-model="ticketstatus.fieldValue" name="ticketstatus" ng-required="ticketstatus.mandatory" ng-options="picklistValue.value as picklistValue.label for picklistValue in ticketstatus.type.picklistValues">
                      </select>
                      <span class="validationtext" ng-show="form.ticketstatus.$dirty && form.ticketstatus.$invalid">
                        <span ng-show="form.ticketstatus.$error.required">{{ticketstatus.label}} is required.</span>
                      </span>
                    </div>
                    <div class="wgt-form-group clearfix padding-right-zero padding-left-one">
                      <label class="fieldlabel" title="{{ticketpriorities.label}}"><span class="redColor mandatoryIndicator" ng-show="ticketpriorities.mandatory">*</span>{{ticketpriorities.label}}</label>
                      <select class="form-control small-input col-sm-12" ng-model="ticketpriorities.fieldValue" name="ticketpriorities" ng-required="ticketpriorities.mandatory" ng-options="picklistValue.value as picklistValue.label for picklistValue in ticketpriorities.type.picklistValues">
                      </select>
                      <span class="validationtext" ng-show="form.ticketpriorities.$dirty && form.ticketpriorities.$invalid">
                        <span ng-show="form.ticketpriorities.$error.required">{{ticketpriorities.label}} is required.</span>
                      </span>
                    </div>
                    <div class="wgt-form-group clearfix">
                      <label class="fieldlabel" title="{{assigned_user_id.label}}"><span class="redColor mandatoryIndicator" ng-show="assigned_user_id.mandatory">*</span>{{assigned_user_id.label}}</label>
                      <select class="form-control small-input col-sm-12" ng-model="assigned_user_id.fieldValue" name="assigned_user_id" ng-required="assigned_user_id.mandatory" ng-options="owner.value as owner.label for owner in owners">
                      </select>
                      <span class="validationtext" ng-show="form.assigned_user_id.$dirty && form.assigned_user_id.$invalid">
                        <span ng-show="form.assigned_user_id.$error.required">{{assigned_user_id.label}} is required.</span>
                      </span>
                    </div>
                    <div class="wgt-form-group clearfix" ng-show="description">
                      <label class="fieldlabel padding-left-zero col-sm-12" title="{{description.label}}"><span class="redColor mandatoryIndicator" ng-show="description.mandatory">*</span>{{description.label}}</label>
                      <textarea class="form-control col-sm-12 commentbox" ng-model="description.fieldValue" ng-required="description.mandatory"></textarea>
                    </div>
                    <div ng-repeat="field in formFields">
                      <div ng-switch on="field.type.name">
                        <div ng-switch-when="string">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="email">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="email" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.email">
                              Invalid email
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="phone">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="owner">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <select class="form-control small-input col-sm-12" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory">
                              <option ng-repeat="owner in owners" value="{{owner.value}}">{{owner.label}}</option>
                            </select>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="picklist">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <select class="form-control small-input col-sm-12" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-options="picklistValue.value as picklistValue.label for picklistValue in field.type.picklistValues">
                            </select>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="integer">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-pattern="/^\d+$/" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number || innerForm.fieldValue.$error.pattern">
                              Enter valid number
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="decimal">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number">
                              Enter valid number
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="date">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <span class="vtinput-prepend">
                              <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" date-picker name="fieldValue" ng-required="field.mandatory" />
                              <span class="vtinput-addon"><i class="fa fa-calendar"></i></span>
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="time">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <span class="vtinput-prepend">
                              <input class="form-control small-input col-sm-12" type="text" class="time" ng-model="field.fieldValue" time-picker name="fieldValue" ng-required="field.mandatory" />
                              <span class="vtinput-addon"><i class="fa fa-clock-o"></i></span>
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="multipicklist">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <ui-select multiple ng-model="field.fieldValue" theme="bootstrap" style="width: 100%;height: 100%;" name="fieldValue" ng-required="field.mandatory" ui-select-required>
                              <ui-select-match placeholder="">{{$item.label}}</ui-select-match>
                              <ui-select-choices repeat="picklistValue.value as picklistValue in  field.type.picklistValues| propsFilter: {label: $select.search}">
                                <div ng-bind-html="picklistValue.label | highlight: $select.search"></div>
                              </ui-select-choices>
                            </ui-select>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="url">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" ng-pattern="/\w+\.\w+/" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.pattern">
                              Enter valid Url
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="skype">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="boolean">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control " type="checkbox" ng-model="field.fieldValue" name="fieldValue" ng-true-value="'1'" ng-false-value="'0'" ng-required="field.mandatory" />
                          </div>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                        </div>
                        <div ng-switch-when="text">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <textarea class="form-control col-sm-12 textarea-field" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory"></textarea>
                          </div>
                          <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                            {{field.label}} is required
                          </span>
                        </div>
                        <div ng-switch-when="double">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" min="0" max="100" ng-minlength="0" ng-maxlength="100" />
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number || innerForm.fieldValue.$error.min || innerForm.fieldValue.$error.max">
                              Enter valid Percentage
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="currency">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <span class="vtinput-prepend">
                              <span class="vtinput-addon">{{userpreferences.currency_symbol}}</span>
                              <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty &&  innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number">
                              Enter valid number
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="multicurrency">
                          <div class="wgt-form-group clearfix" ng-form="innerForm">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <span class="vtinput-prepend">
                              <span class="vtinput-addon">{{userpreferences.currency_symbol}}</span>
                              <input class="form-control small-input col-sm-12" type="number" ng-model="field.fieldValue" name="fieldValue" ng-required="field.mandatory" />
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty &&  innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.number">
                              Enter valid number
                            </span>
                          </div>
                        </div>
                        <div ng-switch-when="reference">
                          <div class="wgt-form-group clearfix" ng-form="innerForm" ng-init="referenceModuleName='{{field.type.refersTo[0]}}'">
                            <label title="{{field.label}}"><span class="redColor mandatoryIndicator" ng-show="field.mandatory">*</span>{{field.label}}</label>
                            <input class="form-control small-input col-sm-12" type="text" ng-model="field.fieldValue" ng-focus="setCurrentReferenceModuleName(field.type.refersTo[0])" name="fieldValue" placeholder="Type to search" typeahead="record as record.label for record in getReferenceRecords($viewValue)" typeahead-editable="true" typeahead-min-length="3" ng-required="field.mandatory">
                            <span class="validationtext" ng-show="innerForm.$dirty && innerForm.fieldValue.$error.required">
                              {{field.label}} is required
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="validationtext animate-show" ng-show="showValidationMsg">
                      Invalid inputs provided
                    </div>
                    <div class="form-group wgt-form-group clearfix formButtons editFormButtonGroup" style="margin-top: 16px;text-align: center;">
                      <button type="submit" class="btn btn-primary btn-xs somemargintop">Save</button>
                      <a class="somemargintop red-color cursor-pointer formcancellink" ng-click="closeForm()">Cancel</a>
                    </div>
                  </form>
                </div>
                <div ng-show="!showForm" class="wgt-list-view clearfix">
                  <div class="wgt-list" ng-repeat="ticket in relatedTickets" ng-init="showEditIcon" ng-mouseenter="showEditIcon = true" ng-mouseleave="showEditIcon = false">
                    <div class="wgt-list-row">
                      <div class="wgt-list-col wgt-list-title">
                        <a href="{{ticket.detailViewUrl}}" title="{{ticket.label}}" target="_blank">{{ticket.label}}</a> <i style="cursor: pointer;" class="fa fa-link" title="Link email to this Ticket" ng-controller="AttachEmailController" ng-really-click="attachEmail(undefined, ticket)" ng-really-message="Do you want to archive this email to Repbox?"></i>
                      </div>
                      <div class="wgt-list-col wgt-list-title pull-right p-0">
                        <span ng-show="showEditIcon">
                          <i ng-show="hasCreatePermission" class="fa fa-pencil cursor-pointer action-icon" ng-click="editRecord(ticket)" title="Edit"></i>
                          <i class="fa fa-comments cursor-pointer action-icon" ng-click="showDetails(ticket)" title="Comment"></i>
                        </span>
                      </div>
                    </div>
                    <div class="wgt-list-row">
                      <div class="wgt-list-col wgt-list-content">
                        <span class="label" ng-class="getLabelClass(ticket.ticketstatus)">{{ticket.ticketstatus}}</span>
                      </div>
                      <div class="wgt-list-col wgt-list-content pull-right col-right">
                        <span>{{ticket.ticketpriorities}}</span>
                      </div>
                    </div>
                    <!--<div class="wgt-list-row">
                                                <div class="wgt-list-col wgt-list-content">
                                                    <i class="icon-contacts"></i><span> {{ticket.contact_id.label}}</span>
                                                </div>
                                                <div class="wgt-list-col wgt-list-content pull-right col-right">
                                                    <i class="icon-organisation"></i><span> {{ticket.parent_id.label}}</span>
                                                </div>
                                            </div>-->
                  </div>
                  <div class="no-data-message" ng-show="!relatedTickets.length && !loading && !showForm">No related tickets</div>
                  <div ng-show="loading && !relatedTickets.length">
                    <img src="<%= baseresourceurl%>assets/images/load.gif" style="display: block; margin-right: auto; margin-left: auto;">
                  </div>
                </div>
              </div>
              <div ng-controller="HelpdeskDetailViewController" ng-show="subview === 'detail'">
                <div class="navigationbar">
                  <span class="cursor-pointer navigationtext" ng-click="changeSubView('list')"><i class="fa fa-arrow-left"></i> Back</span>
                </div>
                <div class="recordDetails">
                  <div class="wgt-detail-view clearfix">
                    <div class="wgt-detail">
                      <div class="wgt-detail-row">
                        <div class="wgt-detail-col wgt-detail-title">
                          <a href="{{record.detailViewUrl}}" target="_blank">{{record.label}}</a>
                        </div>
                        <div class="wgt-detail-col col-right wgt-detail-title pull-right">
                        </div>
                      </div>
                      <div class="wgt-detail-row">
                        <div class="wgt-detail-col wgt-detail-content">
                          <span class="label" ng-class="getLabelClass(record.ticketstatus)">{{record.ticketstatus}}</span>
                        </div>
                        <div class="wgt-detail-col wgt-detail-content pull-right col-right">
                          <span>{{record.ticketpriorities}}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="commentspanel">
                  <div>
                    <form ng-submit="postComment()">
                      <textarea placeholder="Add your comment here.." class="commentbox" ng-model="newcomment"></textarea>
                      <button class="btn btn-primary btn-xs pull-right" type="submit" ng-disabled="!newcomment.length">Add Comment</button>
                    </form>
                  </div>
                  <div class="wgt-list-view clearfix">
                    <div scroll-me="{'height':'280px','start':'top'}">
                      <div class="wgt-list comment" ng-repeat="comment in relatedcomments | reverse">
                        <div class="wgt-list-row">
                          <div class="wgt-list-col wgt-list-content-md">
                            <span class="comment-username">{{comment.assigned_user_id.label}}</span>
                          </div>
                          <div class="wgt-list-col wgt-list-content-sm pull-right">
                            <span><i class="fa fa-clock-o"></i> {{comment.modifiedtime | formatDateTimeToLocalTimeZone}}</span>
                          </div>
                        </div>
                        <div class="wgt-list-row commentcontent">
                          <div class="wgt-list-col wgt-list-content" style="max-width:100%;white-space: pre-line;margin-top: -15px;">
                            <span class="comment-content" ng-bind-html="comment.commentcontent"></span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-content commentstab" ng-show="tab === 'comments'">
            <div ng-controller="CommentsController">
              <div class="listviewheadercontainer">
                <span class="title"> Comments </span>
              </div>
              <div class="commentsviewwrapper">
                <div>
                  <form ng-submit="postComment()">
                    <textarea placeholder="Add your comment here.." class="commentbox" ng-model="newcomment"></textarea>
                    <button class="btn btn-primary btn-xs pull-right" type="submit" ng-disabled="!newcomment.length">Add Comment</button>
                  </form>
                </div>
                <div class="wgt-list-view clearfix" style="display: inline-block;">
                  <div scroll-me="{'height':'335px','start':'top'}">
                    <div class="wgt-list comment" ng-repeat="comment in relatedcomments | reverse">
                      <div class="wgt-list-row">
                        <div class="wgt-list-col wgt-list-content-md">
                          <span class="comment-username">{{comment.assigned_user_id.label}}</span>
                        </div>
                        <div class="wgt-list-col wgt-list-content-sm pull-right">
                          <span><i class="fa fa-clock-o"></i> {{comment.modifiedtime | formatDateTimeToLocalTimeZone}}</span>
                        </div>
                      </div>
                      <div class="wgt-list-row commentcontent">
                        <div class="wgt-list-col wgt-list-content" style="max-width:100%;white-space: pre-line;margin-top: -15px;">
                          <span class="comment-content" ng-bind-html="comment.commentcontent"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-content settingstab" ng-show="tab === 'settings'">
            <div ng-controller="SettingsController">
              <div class="listviewheadercontainer">
                <span class="title"> Settings </span>
              </div>
              <div class="setting-list-view clearfix">
                <div class="setting-list" ng-repeat="modulesetting in moduleSettings">
                  <div class="setting-list-row clearfix">
                    <div class="setting-list-col setting-list-col-title">
                      <i class="fa" ng-class="getIconClass(modulesetting.module.name)"></i> <span>{{modulesetting.module.label}}</span>
                    </div>
                    <div class="setting-list-col pull-right">
                      <toggle-switch ng-model="modulesetting.active" ng-click="saveSettings()">
                        <toggle-switch>
                    </div>
                  </div>
                </div>
                <!--<div>
                                        <span class="savesettings">
                                            <button class="btn btn-success" ng-click="saveSettings()">Save</button>
                                        </span>
                                    </div>-->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div ng-show="view === 'busy'">
    <img src="<%= baseresourceurl%>assets/images/loading.gif" style="display: block; margin-right: auto; margin-left: auto;">
  </div>
</div>